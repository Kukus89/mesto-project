(()=>{"use strict";var e=document.querySelector(".profile__avatar"),t=document.querySelector(".popup__submite-button_profile-save"),n={baseUrl:"https://nomoreparties.co/v1/plus-cohort-21",headers:{authorization:"db2903a8-7d87-407f-a3ab-4cc55fb57270","Content-Type":"application/json"}},o=function(){return fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(t){a.textContent=t.name,s.textContent=t.about,e.src=t.avatar})).catch((function(e){console.log("Ошибка: ".concat(e))}))};o(),fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){e.forEach((function(e){x.prepend(J(e))}))})).catch((function(e){console.log("Ошибка: ".concat(e))}));var r=function(e){fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(){L(g.closest(".popup")),g.textContent="Да"})).catch((function(e){console.log("Ошибка: ".concat(e))}))},c=function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log("Ошибка: ".concat(e))}))},u=function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.log("Ошибка: ".concat(e))}))},a=document.querySelector(".profile__name"),s=document.querySelector(".profile__subtitle"),i=document.querySelector(".popup__profile_name"),l=document.querySelector(".popup__profile_subtitle"),d=document.querySelector(".popup_edite-profile"),p=document.querySelector(".popup_edite-avatar"),m=p.querySelector(".popup__submite-button_edite-avatar"),f=document.querySelector(".profile"),_=f.querySelector(".profile__edite-button"),v=f.querySelector(".profile__add-button"),h=document.querySelector(".profile__edite-overlay"),y=document.querySelector(".popup_edite-avatar"),S=document.forms["profile-edite-form"],b=document.querySelectorAll(".popup"),q=p.querySelector(".popup__form-input"),C=d.querySelector(".popup__submite-button_profile-save");function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",E)}function L(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",E)}function E(e){"Escape"===e.key&&L(document.querySelector(".popup_opened"))}_.addEventListener("click",(function(){k(d),i.value=a.textContent,l.value=s.textContent})),v.addEventListener("click",(function(){k(j)})),b.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&L(e),t.target.classList.contains("popup__close-button")&&L(e)}))})),S.addEventListener("submit",(function(e){var r,c;e.preventDefault(),C.textContent="Сохранение",r=i.value,c=l.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:r,about:c})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(){L(t.closest(".popup")),t.textContent="Сохранить"})).catch((function(e){console.log("Ошибка: ".concat(e))})),o()})),h.addEventListener("click",(function(){k(y),document.forms.editeAvatarForm.addEventListener("submit",(function(e){var t;e.preventDefault(),m.textContent="Сохранение",t=q.value,fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(){L(p),m.textContent="Сохранить"})).catch((function(e){console.log("Ошибка: ".concat(e))})),o()}))}));var g=document.querySelector(".popup__submite-button_confirm-delete"),x=document.querySelector(".elements__list"),j=document.querySelector(".popup_card-add"),P=document.querySelector(".popup__submite-button_card-add"),U=document.querySelector(".popup__area-name"),A=document.querySelector(".popup__src-image"),w=document.querySelector(".popup__container_newCardAdd"),T=document.querySelector(".templateElements").content,B=document.querySelector(".popup_preview"),D=document.querySelector(".popup__preview-image"),N=document.querySelector(".popup__preview-image-subtitle"),O=document.querySelector(".popup_confirm-delete");function J(e){var t=T.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__image"),o=t.querySelector(".element__like"),s=t.querySelector(".element__delete-button"),i=t.querySelector(".element__like-quantity");return e.owner.name!==a.textContent&&s.remove(),n.src=e.link,n.alt='Здесь должна быть фотография "'.concat(e.name,'"'),i.textContent=e.likes.length,t.querySelector(".element__title").textContent=e.name,s.addEventListener("click",(function(){k(O),O.classList.contains("popup_opened")&&g.addEventListener("click",(function(){r(e._id,t),g.textContent="Удаление",s.closest(".element").remove()}),{once:!0})})),e.likes.forEach((function(e){"962d657b2afc25af033ca0a3"==e._id&&o.classList.toggle("element__like_active")})),o.addEventListener("click",(function(){o.classList.contains("element__like_active")?u(e._id).then((function(e){o.classList.toggle("element__like_active"),i.textContent=e.likes.length})):c(e._id).then((function(e){o.classList.toggle("element__like_active"),i.textContent=e.likes.length}))})),n.addEventListener("click",(function(){D.alt='Здесь должна быть фотография "'.concat(e.name,'"'),D.src=e.link,N.textContent=e.name,k(B)})),t}w.addEventListener("submit",(function(e){var t,o;e.preventDefault(),P.textContent="Сохранение",t=U.value,o=A.value,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){var t=e;x.prepend(J(t))})).then((function(){P.textContent="Сохранить",L(P.closest(".popup"))})).catch((function(e){console.log("Ошибка: ".concat(e))})),e.target.reset()})),function(e){function t(t,n){t.some((function(e){return!e.validity.valid}))?(n.disabled=!0,n.classList.add(e.inactiveButtonClass)):(n.disabled=!1,n.classList.remove(e.inactiveButtonClass))}Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){var o=Array.from(n.querySelectorAll(e.inputSelector)),r=n.querySelector(e.submitButtonSelector);t(o,r),n.addEventListener("reset",(function(){setTimeout((function(){t(o,r)}),0)})),o.forEach((function(c){c.addEventListener("input",(function(){(function(t,n){var o,r,c,u;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.textContent="",o.classList.remove(e.errorClass)}(t,n):(o=t,r=n,c=n.validationMessage,u=o.querySelector(".".concat(r.id,"-error")),r.classList.add(e.inputErrorClass),u.textContent=c,u.classList.add(e.errorClass))})(n,c),t(o,r)}))}))}))}({formSelector:".input-form",inputSelector:".popup__form-input",submitButtonSelector:".popup__submite-button",inactiveButtonClass:"popup__submite-button_disabled",inputErrorClass:"popup__form-input_type_error",errorClass:"popup__input-error-message_active"})})();